# Data Model: Phase II Task CRUD Operations

## Overview
Data model for the full-stack todo application with user authentication and task ownership enforcement.

## Entity Definitions

### Task
Represents a user's todo item with properties for managing tasks.

**Fields**:
- `id`: UUID (Primary Key, auto-generated)
- `title`: String (Required, max_length=255)
- `description`: String (Optional, max_length=1000)
- `completed`: Boolean (Default: False)
- `due_date`: DateTime (Optional)
- `created_at`: DateTime (Auto-generated, timezone-aware)
- `updated_at`: DateTime (Auto-generated, timezone-aware, updates on modification)
- `owner_id`: UUID (Foreign Key to User, required)

**Validation Rules**:
- Title must be 1-255 characters
- Description, if provided, must be 1-1000 characters
- Due date, if provided, must be in the future
- Owner_id must reference an existing user

**State Transitions**:
- Pending (completed=False) → Completed (completed=True) when marked as complete
- Completed (completed=True) → Pending (completed=False) when marked as incomplete

**Relationships**:
- Many Tasks belong to One User (via owner_id foreign key)

### User
Represents an authenticated user managed by Better Auth system.

**Fields**:
- `id`: UUID (Primary Key, auto-generated by Better Auth)
- `email`: String (Unique, required, validated as email format)
- `username`: String (Unique, optional)
- `created_at`: DateTime (Auto-generated)
- `updated_at`: DateTime (Auto-generated, updates on modification)

**Note**: User entity is primarily managed by Better Auth system, but referenced by Task entities.

## Database Schema

### Tasks Table
```sql
CREATE TABLE tasks (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    title VARCHAR(255) NOT NULL,
    description TEXT,
    completed BOOLEAN DEFAULT FALSE,
    due_date TIMESTAMP WITH TIME ZONE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    owner_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE
);

CREATE INDEX idx_tasks_owner_id ON tasks(owner_id);
CREATE INDEX idx_tasks_completed ON tasks(completed);
CREATE INDEX idx_tasks_due_date ON tasks(due_date);
```

### Access Control
All queries to the tasks table must include a WHERE clause filtering by the authenticated user's ID to enforce ownership.

## Business Logic Constraints

1. **Ownership Enforcement**: Users can only access tasks where owner_id matches their user ID
2. **Data Integrity**: Cascade deletion removes all tasks when a user is deleted
3. **Validation**: Title is required and must be between 1-255 characters
4. **Timestamps**: Automatic creation and update timestamps maintained by the system

## API Representation

### Task Resource (JSON)
```json
{
  "id": "uuid-string",
  "title": "Task title (string)",
  "description": "Optional description (string)",
  "completed": false,
  "due_date": "2023-12-31T23:59:59Z",
  "created_at": "2023-01-01T12:00:00Z",
  "updated_at": "2023-01-01T12:00:00Z"
}
```

### Request/Response Validation
- Input validation using Pydantic models
- Output serialization using the same models
- Automatic conversion between database and API representations